<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>vps 登录推送 | johnpoint's blog</title><meta name=keywords content="vps,安全"><meta name=description content="国内的云服务器大多数都自带了 ssh 登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至 telegram 的功能
文件名 00-ssh-login-alarm-telegram.sh (其实也可以自己自定义)，将文件放在 /etc/profile.d 目录下。
#!/bin/bash #填入 telegram bot 的 token token= #填自己telegram的id id= #vps ip vpsip=$(curl -s ip.sb -4) #登录时间 logintime=$(TZ=UTC-8 date '+%Y-%m-%d %H:%M:%S') #远程登录的ip loginip=$(who -u am i 2>/dev/null| awk '{print $NF}'|sed -e 's/[()]//g') #ip归属asn组织名称 loginfrom=$(curl -s https://api.ip.sb/geoip/${loginip} | jq .asn_organization) curl -s &#34;https://api.telegram.org/bot${token}/sendMessage?chat_id=${id}&#34; --data-binary &#34;&text=NewLogin:%0AVPS: ${vpsip}%0ATime: ${logintime}%0ALogin from:%0A${loginip}%0A${loginfrom}&#34; > /dev/null 因为用到了 jq 作为解析 json 的工具，所以需要在包管理器中自行安装。
使用效果：
NewLogin: VPS: ***.***.***.*** Time: 2020-09-13 12:41:24 Login from: ***."><meta name=author content="johnpoint"><link rel=canonical href=https://blog.lvcshu.com/2020/09/13/vps-%E7%99%BB%E5%BD%95%E6%8E%A8%E9%80%81/><link crossorigin=anonymous href=/assets/css/stylesheet.635203c1629fde69896622bdc0aee4210e2fa2ca161e2cc0cf7ea8ccf604149e.css integrity="sha256-Y1IDwWKf3mmJZiK9wK7kIQ4vosoWHizAz36ozPYEFJ4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.lvcshu.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.lvcshu.com/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://blog.lvcshu.com/favicon.ico><link rel=apple-touch-icon href=https://blog.lvcshu.com/favicon.ico><link rel=mask-icon href=https://blog.lvcshu.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="vps 登录推送"><meta property="og:description" content="国内的云服务器大多数都自带了 ssh 登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至 telegram 的功能
文件名 00-ssh-login-alarm-telegram.sh (其实也可以自己自定义)，将文件放在 /etc/profile.d 目录下。
#!/bin/bash #填入 telegram bot 的 token token= #填自己telegram的id id= #vps ip vpsip=$(curl -s ip.sb -4) #登录时间 logintime=$(TZ=UTC-8 date '+%Y-%m-%d %H:%M:%S') #远程登录的ip loginip=$(who -u am i 2>/dev/null| awk '{print $NF}'|sed -e 's/[()]//g') #ip归属asn组织名称 loginfrom=$(curl -s https://api.ip.sb/geoip/${loginip} | jq .asn_organization) curl -s &#34;https://api.telegram.org/bot${token}/sendMessage?chat_id=${id}&#34; --data-binary &#34;&text=NewLogin:%0AVPS: ${vpsip}%0ATime: ${logintime}%0ALogin from:%0A${loginip}%0A${loginfrom}&#34; > /dev/null 因为用到了 jq 作为解析 json 的工具，所以需要在包管理器中自行安装。
使用效果：
NewLogin: VPS: ***.***.***.*** Time: 2020-09-13 12:41:24 Login from: ***."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.lvcshu.com/2020/09/13/vps-%E7%99%BB%E5%BD%95%E6%8E%A8%E9%80%81/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-13T13:10:21+00:00"><meta property="article:modified_time" content="2020-09-13T13:10:21+00:00"><meta property="og:site_name" content="johnpoint's blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="vps 登录推送"><meta name=twitter:description content="国内的云服务器大多数都自带了 ssh 登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至 telegram 的功能
文件名 00-ssh-login-alarm-telegram.sh (其实也可以自己自定义)，将文件放在 /etc/profile.d 目录下。
#!/bin/bash #填入 telegram bot 的 token token= #填自己telegram的id id= #vps ip vpsip=$(curl -s ip.sb -4) #登录时间 logintime=$(TZ=UTC-8 date '+%Y-%m-%d %H:%M:%S') #远程登录的ip loginip=$(who -u am i 2>/dev/null| awk '{print $NF}'|sed -e 's/[()]//g') #ip归属asn组织名称 loginfrom=$(curl -s https://api.ip.sb/geoip/${loginip} | jq .asn_organization) curl -s &#34;https://api.telegram.org/bot${token}/sendMessage?chat_id=${id}&#34; --data-binary &#34;&text=NewLogin:%0AVPS: ${vpsip}%0ATime: ${logintime}%0ALogin from:%0A${loginip}%0A${loginfrom}&#34; > /dev/null 因为用到了 jq 作为解析 json 的工具，所以需要在包管理器中自行安装。
使用效果：
NewLogin: VPS: ***.***.***.*** Time: 2020-09-13 12:41:24 Login from: ***."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.lvcshu.com/posts/"},{"@type":"ListItem","position":2,"name":"vps 登录推送","item":"https://blog.lvcshu.com/2020/09/13/vps-%E7%99%BB%E5%BD%95%E6%8E%A8%E9%80%81/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"vps 登录推送","name":"vps 登录推送","description":"国内的云服务器大多数都自带了 ssh 登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至 telegram 的功能\n文件名 00-ssh-login-alarm-telegram.sh (其实也可以自己自定义)，将文件放在 /etc/profile.d 目录下。\n#!/bin/bash #填入 telegram bot 的 token token= #填自己telegram的id id= #vps ip vpsip=$(curl -s ip.sb -4) #登录时间 logintime=$(TZ=UTC-8 date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) #远程登录的ip loginip=$(who -u am i 2\u0026gt;/dev/null| awk \u0026#39;{print $NF}\u0026#39;|sed -e \u0026#39;s/[()]//g\u0026#39;) #ip归属asn组织名称 loginfrom=$(curl -s https://api.ip.sb/geoip/${loginip} | jq .asn_organization) curl -s \u0026#34;https://api.telegram.org/bot${token}/sendMessage?chat_id=${id}\u0026#34; --data-binary \u0026#34;\u0026amp;text=NewLogin:%0AVPS: ${vpsip}%0ATime: ${logintime}%0ALogin from:%0A${loginip}%0A${loginfrom}\u0026#34; \u0026gt; /dev/null 因为用到了 jq 作为解析 json 的工具，所以需要在包管理器中自行安装。\n使用效果：\nNewLogin: VPS: ***.***.***.*** Time: 2020-09-13 12:41:24 Login from: ***.","keywords":["vps","安全"],"articleBody":"国内的云服务器大多数都自带了 ssh 登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至 telegram 的功能\n文件名 00-ssh-login-alarm-telegram.sh (其实也可以自己自定义)，将文件放在 /etc/profile.d 目录下。\n#!/bin/bash #填入 telegram bot 的 token token= #填自己telegram的id id= #vps ip vpsip=$(curl -s ip.sb -4) #登录时间 logintime=$(TZ=UTC-8 date '+%Y-%m-%d %H:%M:%S') #远程登录的ip loginip=$(who -u am i 2\u003e/dev/null| awk '{print $NF}'|sed -e 's/[()]//g') #ip归属asn组织名称 loginfrom=$(curl -s https://api.ip.sb/geoip/${loginip} | jq .asn_organization) curl -s \"https://api.telegram.org/bot${token}/sendMessage?chat_id=${id}\" --data-binary \"\u0026text=NewLogin:%0AVPS: ${vpsip}%0ATime: ${logintime}%0ALogin from:%0A${loginip}%0A${loginfrom}\" \u003e /dev/null 因为用到了 jq 作为解析 json 的工具，所以需要在包管理器中自行安装。\n使用效果：\nNewLogin: VPS: ***.***.***.*** Time: 2020-09-13 12:41:24 Login from: ***.***.***.*** \"asn_organization\" 脚本使用的 api 来自 ip.sb\n2021-10-20 更新 脚本中间更新了几个版本，现在的脚本已经可以实现之前所缺少的一些功能\n显示登录用户名 不阻塞登录用户的 TTY #!/bin/bash #填入 telegram bot 的 token token= #填自己telegram的id id= localip=$(who -u am i 2\u003e/dev/null| awk '{print $NF}'|sed -e 's/[()]//g') echo 'localip=$(curl -s ip.sb -4)' \u003e tg.sh echo 'user=$(whoami)' \u003e\u003e tg.sh echo 'logintime=$(TZ=UTC-8 date \"+%Y-%m-%d %H:%M:%S\")' \u003e\u003e tg.sh echo 'loginip='${localip} \u003e\u003e tg.sh echo 'loginfrom=$(curl -s https://api.ip.sb/geoip/${loginip} | jq -r .asn_organization)' \u003e\u003e tg.sh echo 'curl -s \"https://api.telegram.org/bot'${token}'/sendMessage?chat_id='${id}'\" --data-binary \"\u0026text=NewLogin:%0AVPS:${user}@${localip}%0ATime: ${logintime}%0ALogin from:%0A${loginip}%0A${loginfrom}\" \u003e /dev/null \u0026\u0026 rm tg.sh' \u003e\u003e tg.sh bash tg.sh \u0026 ","wordCount":"153","inLanguage":"en","datePublished":"2020-09-13T13:10:21Z","dateModified":"2020-09-13T13:10:21Z","author":{"@type":"Person","name":"johnpoint"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.lvcshu.com/2020/09/13/vps-%E7%99%BB%E5%BD%95%E6%8E%A8%E9%80%81/"},"publisher":{"@type":"Organization","name":"johnpoint's blog","logo":{"@type":"ImageObject","url":"https://blog.lvcshu.com/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://blog.lvcshu.com/ accesskey=h title="johnpoint's blog (Alt + H)">johnpoint's blog</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://blog.lvcshu.com/posts/ title=归档><span>归档</span></a></li><li><a href=https://blog.lvcshu.com/friends/ title=友链><span>友链</span></a></li><li><a href=https://blog.lvcshu.com/about/ title=关于我><span>关于我</span></a></li><li><a href=https://blog.lvcshu.com/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>vps 登录推送</h1><div class=post-meta><span title='2020-09-13 13:10:21 +0000 UTC'>2020-09-13 13:10:21</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;153 words&nbsp;·&nbsp;johnpoint</div></header><div class=post-content><p>国内的云服务器大多数都自带了 ssh 登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至 telegram 的功能</p><p>文件名 <code>00-ssh-login-alarm-telegram.sh</code> (其实也可以自己自定义)，将文件放在 <code>/etc/profile.d</code> 目录下。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>#填入 telegram bot 的 token</span>
</span></span><span class=line><span class=cl><span class=nv>token</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=c1>#填自己telegram的id</span>
</span></span><span class=line><span class=cl><span class=nv>id</span><span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#vps ip</span>
</span></span><span class=line><span class=cl><span class=nv>vpsip</span><span class=o>=</span><span class=k>$(</span>curl -s ip.sb -4<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=c1>#登录时间</span>
</span></span><span class=line><span class=cl><span class=nv>logintime</span><span class=o>=</span><span class=k>$(</span><span class=nv>TZ</span><span class=o>=</span>UTC-8 date <span class=s1>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=c1>#远程登录的ip</span>
</span></span><span class=line><span class=cl><span class=nv>loginip</span><span class=o>=</span><span class=k>$(</span>who -u am i 2&gt;/dev/null<span class=p>|</span> awk <span class=s1>&#39;{print $NF}&#39;</span><span class=p>|</span>sed -e <span class=s1>&#39;s/[()]//g&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=c1>#ip归属asn组织名称</span>
</span></span><span class=line><span class=cl><span class=nv>loginfrom</span><span class=o>=</span><span class=k>$(</span>curl -s https://api.ip.sb/geoip/<span class=si>${</span><span class=nv>loginip</span><span class=si>}</span> <span class=p>|</span> jq .asn_organization<span class=k>)</span>
</span></span><span class=line><span class=cl>curl -s <span class=s2>&#34;https://api.telegram.org/bot</span><span class=si>${</span><span class=nv>token</span><span class=si>}</span><span class=s2>/sendMessage?chat_id=</span><span class=si>${</span><span class=nv>id</span><span class=si>}</span><span class=s2>&#34;</span> --data-binary <span class=s2>&#34;&amp;text=NewLogin:%0AVPS: </span><span class=si>${</span><span class=nv>vpsip</span><span class=si>}</span><span class=s2>%0ATime: </span><span class=si>${</span><span class=nv>logintime</span><span class=si>}</span><span class=s2>%0ALogin from:%0A</span><span class=si>${</span><span class=nv>loginip</span><span class=si>}</span><span class=s2>%0A</span><span class=si>${</span><span class=nv>loginfrom</span><span class=si>}</span><span class=s2>&#34;</span> &gt; /dev/null
</span></span></code></pre></div><p>因为用到了 <code>jq</code> 作为解析 json 的工具，所以需要在包管理器中自行安装。</p><p>使用效果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>NewLogin:
</span></span><span class=line><span class=cl>VPS: ***.***.***.***
</span></span><span class=line><span class=cl>Time: 2020-09-13 12:41:24
</span></span><span class=line><span class=cl>Login from:
</span></span><span class=line><span class=cl>***.***.***.***
</span></span><span class=line><span class=cl>&#34;asn_organization&#34;
</span></span></code></pre></div><p><em>脚本使用的 api 来自 ip.sb</em></p><h3 id=2021-10-20-更新>2021-10-20 更新<a hidden class=anchor aria-hidden=true href=#2021-10-20-更新>#</a></h3><p>脚本中间更新了几个版本，现在的脚本已经可以实现之前所缺少的一些功能</p><ul><li>显示登录用户名</li><li>不阻塞登录用户的 TTY</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>#填入 telegram bot 的 token</span>
</span></span><span class=line><span class=cl><span class=nv>token</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=c1>#填自己telegram的id</span>
</span></span><span class=line><span class=cl><span class=nv>id</span><span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>localip</span><span class=o>=</span><span class=k>$(</span>who -u am i 2&gt;/dev/null<span class=p>|</span> awk <span class=s1>&#39;{print $NF}&#39;</span><span class=p>|</span>sed -e <span class=s1>&#39;s/[()]//g&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;localip=$(curl -s ip.sb -4)&#39;</span> &gt; tg.sh
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;user=$(whoami)&#39;</span> &gt;&gt; tg.sh
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;logintime=$(TZ=UTC-8 date &#34;+%Y-%m-%d %H:%M:%S&#34;)&#39;</span> &gt;&gt; tg.sh
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;loginip=&#39;</span><span class=si>${</span><span class=nv>localip</span><span class=si>}</span> &gt;&gt; tg.sh
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;loginfrom=$(curl -s https://api.ip.sb/geoip/${loginip} | jq -r .asn_organization)&#39;</span> &gt;&gt; tg.sh
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;curl -s &#34;https://api.telegram.org/bot&#39;</span><span class=si>${</span><span class=nv>token</span><span class=si>}</span><span class=s1>&#39;/sendMessage?chat_id=&#39;</span><span class=si>${</span><span class=nv>id</span><span class=si>}</span><span class=s1>&#39;&#34; --data-binary &#34;&amp;text=NewLogin:%0AVPS:${user}@${localip}%0ATime: ${logintime}%0ALogin from:%0A${loginip}%0A${loginfrom}&#34; &gt; /dev/null &amp;&amp; rm tg.sh&#39;</span> &gt;&gt; tg.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>bash tg.sh <span class=p>&amp;</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.lvcshu.com/tags/vps/>vps</a></li><li><a href=https://blog.lvcshu.com/tags/%E5%AE%89%E5%85%A8/>安全</a></li></ul><script>var pageInfo=`{"Content":"\\u003cp\\u003e国内的云服务器大多数都自带了 ssh 登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至 telegram 的功能\\u003c/p\\u003e\\n\\u003cp\\u003e文件名 \\u003ccode\\u003e00-ssh-login-alarm-telegram.sh\\u003c/code\\u003e (其实也可以自己自定义)，将文件放在 \\u003ccode\\u003e/etc/profile.d\\u003c/code\\u003e 目录下。\\u003c/p\\u003e\\n\\u003cdiv class=\\"highlight\\"\\u003e\\u003cpre tabindex=\\"0\\" class=\\"chroma\\"\\u003e\\u003ccode class=\\"language-bash\\" data-lang=\\"bash\\"\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"cp\\"\\u003e#!/bin/bash\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"cp\\"\\u003e\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"c1\\"\\u003e#填入 telegram bot 的 token\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nv\\"\\u003etoken\\u003c/span\\u003e\\u003cspan class=\\"o\\"\\u003e=\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"c1\\"\\u003e#填自己telegram的id\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nv\\"\\u003eid\\u003c/span\\u003e\\u003cspan class=\\"o\\"\\u003e=\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"c1\\"\\u003e#vps ip\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nv\\"\\u003evpsip\\u003c/span\\u003e\\u003cspan class=\\"o\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"k\\"\\u003e$(\\u003c/span\\u003ecurl -s ip.sb -4\\u003cspan class=\\"k\\"\\u003e)\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"c1\\"\\u003e#登录时间\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nv\\"\\u003elogintime\\u003c/span\\u003e\\u003cspan class=\\"o\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"k\\"\\u003e$(\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003eTZ\\u003c/span\\u003e\\u003cspan class=\\"o\\"\\u003e=\\u003c/span\\u003eUTC-8 date \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;+%Y-%m-%d %H:%M:%S\\u0026#39;\\u003c/span\\u003e\\u003cspan class=\\"k\\"\\u003e)\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"c1\\"\\u003e#远程登录的ip\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nv\\"\\u003eloginip\\u003c/span\\u003e\\u003cspan class=\\"o\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"k\\"\\u003e$(\\u003c/span\\u003ewho -u am i 2\\u0026gt;/dev/null\\u003cspan class=\\"p\\"\\u003e|\\u003c/span\\u003e awk \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;{print $NF}\\u0026#39;\\u003c/span\\u003e\\u003cspan class=\\"p\\"\\u003e|\\u003c/span\\u003esed -e \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;s/[()]//g\\u0026#39;\\u003c/span\\u003e\\u003cspan class=\\"k\\"\\u003e)\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"c1\\"\\u003e#ip归属asn组织名称\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nv\\"\\u003eloginfrom\\u003c/span\\u003e\\u003cspan class=\\"o\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"k\\"\\u003e$(\\u003c/span\\u003ecurl -s https://api.ip.sb/geoip/\\u003cspan class=\\"si\\"\\u003e\${\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003eloginip\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e}\\u003c/span\\u003e \\u003cspan class=\\"p\\"\\u003e|\\u003c/span\\u003e jq .asn_organization\\u003cspan class=\\"k\\"\\u003e)\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003ecurl -s \\u003cspan class=\\"s2\\"\\u003e\\u0026#34;https://api.telegram.org/bot\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e\${\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003etoken\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"s2\\"\\u003e/sendMessage?chat_id=\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e\${\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003eid\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"s2\\"\\u003e\\u0026#34;\\u003c/span\\u003e --data-binary \\u003cspan class=\\"s2\\"\\u003e\\u0026#34;\\u0026amp;text=NewLogin:%0AVPS: \\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e\${\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003evpsip\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"s2\\"\\u003e%0ATime: \\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e\${\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003elogintime\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"s2\\"\\u003e%0ALogin from:%0A\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e\${\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003eloginip\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"s2\\"\\u003e%0A\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e\${\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003eloginfrom\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"s2\\"\\u003e\\u0026#34;\\u003c/span\\u003e \\u0026gt; /dev/null\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003c/code\\u003e\\u003c/pre\\u003e\\u003c/div\\u003e\\u003cp\\u003e因为用到了 \\u003ccode\\u003ejq\\u003c/code\\u003e 作为解析 json 的工具，所以需要在包管理器中自行安装。\\u003c/p\\u003e\\n\\u003cp\\u003e使用效果：\\u003c/p\\u003e\\n\\u003cdiv class=\\"highlight\\"\\u003e\\u003cpre tabindex=\\"0\\" class=\\"chroma\\"\\u003e\\u003ccode class=\\"language-fallback\\" data-lang=\\"fallback\\"\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003eNewLogin:\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003eVPS: ***.***.***.***\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003eTime: 2020-09-13 12:41:24\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003eLogin from:\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e***.***.***.***\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u0026#34;asn_organization\\u0026#34;\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003c/code\\u003e\\u003c/pre\\u003e\\u003c/div\\u003e\\u003cp\\u003e\\u003cem\\u003e脚本使用的 api 来自 ip.sb\\u003c/em\\u003e\\u003c/p\\u003e\\n\\u003ch3 id=\\"2021-10-20-更新\\"\\u003e2021-10-20 更新\\u003c/h3\\u003e\\n\\u003cp\\u003e脚本中间更新了几个版本，现在的脚本已经可以实现之前所缺少的一些功能\\u003c/p\\u003e\\n\\u003cul\\u003e\\n\\u003cli\\u003e显示登录用户名\\u003c/li\\u003e\\n\\u003cli\\u003e不阻塞登录用户的 TTY\\u003c/li\\u003e\\n\\u003c/ul\\u003e\\n\\u003cdiv class=\\"highlight\\"\\u003e\\u003cpre tabindex=\\"0\\" class=\\"chroma\\"\\u003e\\u003ccode class=\\"language-shell\\" data-lang=\\"shell\\"\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"cp\\"\\u003e#!/bin/bash\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"cp\\"\\u003e\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"c1\\"\\u003e#填入 telegram bot 的 token\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nv\\"\\u003etoken\\u003c/span\\u003e\\u003cspan class=\\"o\\"\\u003e=\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"c1\\"\\u003e#填自己telegram的id\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nv\\"\\u003eid\\u003c/span\\u003e\\u003cspan class=\\"o\\"\\u003e=\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nv\\"\\u003elocalip\\u003c/span\\u003e\\u003cspan class=\\"o\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"k\\"\\u003e$(\\u003c/span\\u003ewho -u am i 2\\u0026gt;/dev/null\\u003cspan class=\\"p\\"\\u003e|\\u003c/span\\u003e awk \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;{print $NF}\\u0026#39;\\u003c/span\\u003e\\u003cspan class=\\"p\\"\\u003e|\\u003c/span\\u003esed -e \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;s/[()]//g\\u0026#39;\\u003c/span\\u003e\\u003cspan class=\\"k\\"\\u003e)\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nb\\"\\u003eecho\\u003c/span\\u003e \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;localip=$(curl -s ip.sb -4)\\u0026#39;\\u003c/span\\u003e \\u0026gt; tg.sh\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nb\\"\\u003eecho\\u003c/span\\u003e \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;user=$(whoami)\\u0026#39;\\u003c/span\\u003e \\u0026gt;\\u0026gt; tg.sh\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nb\\"\\u003eecho\\u003c/span\\u003e \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;logintime=$(TZ=UTC-8 date \\u0026#34;+%Y-%m-%d %H:%M:%S\\u0026#34;)\\u0026#39;\\u003c/span\\u003e \\u0026gt;\\u0026gt; tg.sh\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nb\\"\\u003eecho\\u003c/span\\u003e \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;loginip=\\u0026#39;\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e\${\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003elocalip\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e}\\u003c/span\\u003e \\u0026gt;\\u0026gt; tg.sh\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nb\\"\\u003eecho\\u003c/span\\u003e \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;loginfrom=$(curl -s https://api.ip.sb/geoip/\${loginip} | jq -r .asn_organization)\\u0026#39;\\u003c/span\\u003e \\u0026gt;\\u0026gt; tg.sh\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\u003cspan class=\\"nb\\"\\u003eecho\\u003c/span\\u003e \\u003cspan class=\\"s1\\"\\u003e\\u0026#39;curl -s \\u0026#34;https://api.telegram.org/bot\\u0026#39;\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e\${\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003etoken\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"s1\\"\\u003e\\u0026#39;/sendMessage?chat_id=\\u0026#39;\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e\${\\u003c/span\\u003e\\u003cspan class=\\"nv\\"\\u003eid\\u003c/span\\u003e\\u003cspan class=\\"si\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"s1\\"\\u003e\\u0026#39;\\u0026#34; --data-binary \\u0026#34;\\u0026amp;text=NewLogin:%0AVPS:\${user}@\${localip}%0ATime: \${logintime}%0ALogin from:%0A\${loginip}%0A\${loginfrom}\\u0026#34; \\u0026gt; /dev/null \\u0026amp;\\u0026amp; rm tg.sh\\u0026#39;\\u003c/span\\u003e \\u0026gt;\\u0026gt; tg.sh\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003cspan class=\\"line\\"\\u003e\\u003cspan class=\\"cl\\"\\u003ebash tg.sh \\u003cspan class=\\"p\\"\\u003e\\u0026amp;\\u003c/span\\u003e\\n\\u003c/span\\u003e\\u003c/span\\u003e\\u003c/code\\u003e\\u003c/pre\\u003e\\u003c/div\\u003e","Plain":"国内的云服务器大多数都自带了 ssh 登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至 telegram 的功能\\n文件名 00-ssh-login-alarm-telegram.sh (其实也可以自己自定义)，将文件放在 /etc/profile.d 目录下。\\n#!/bin/bash #填入 telegram bot 的 token token= #填自己telegram的id id= #vps ip vpsip=$(curl -s ip.sb -4) #登录时间 logintime=$(TZ=UTC-8 date \\u0026#39;+%Y-%m-%d %H:%M:%S\\u0026#39;) #远程登录的ip loginip=$(who -u am i 2\\u0026gt;/dev/null| awk \\u0026#39;{print $NF}\\u0026#39;|sed -e \\u0026#39;s/[()]//g\\u0026#39;) #ip归属asn组织名称 loginfrom=$(curl -s https://api.ip.sb/geoip/\${loginip} | jq .asn_organization) curl -s \\u0026#34;https://api.telegram.org/bot\${token}/sendMessage?chat_id=\${id}\\u0026#34; --data-binary \\u0026#34;\\u0026amp;text=NewLogin:%0AVPS: \${vpsip}%0ATime: \${logintime}%0ALogin from:%0A\${loginip}%0A\${loginfrom}\\u0026#34; \\u0026gt; /dev/null 因为用到了 jq 作为解析 json 的工具，所以需要在包管理器中自行安装。\\n使用效果：\\nNewLogin: VPS: ***.***.***.*** Time: 2020-09-13 12:41:24 Login from: ***.***.***.*** \\u0026#34;asn_organization\\u0026#34; 脚本使用的 api 来自 ip.sb\\n2021-10-20 更新 脚本中间更新了几个版本，现在的脚本已经可以实现之前所缺少的一些功能\\n显示登录用户名 不阻塞登录用户的 TTY #!/bin/bash #填入 telegram bot 的 token token= #填自己telegram的id id= localip=$(who -u am i 2\\u0026gt;/dev/null| awk \\u0026#39;{print $NF}\\u0026#39;|sed -e \\u0026#39;s/[()]//g\\u0026#39;) echo \\u0026#39;localip=$(curl -s ip.sb -4)\\u0026#39; \\u0026gt; tg.sh echo \\u0026#39;user=$(whoami)\\u0026#39; \\u0026gt;\\u0026gt; tg.sh echo \\u0026#39;logintime=$(TZ=UTC-8 date \\u0026#34;+%Y-%m-%d %H:%M:%S\\u0026#34;)\\u0026#39; \\u0026gt;\\u0026gt; tg.sh echo \\u0026#39;loginip=\\u0026#39;\${localip} \\u0026gt;\\u0026gt; tg.sh echo \\u0026#39;loginfrom=$(curl -s https://api.ip.sb/geoip/\${loginip} | jq -r .asn_organization)\\u0026#39; \\u0026gt;\\u0026gt; tg.sh echo \\u0026#39;curl -s \\u0026#34;https://api.telegram.org/bot\\u0026#39;\${token}\\u0026#39;/sendMessage?chat_id=\\u0026#39;\${id}\\u0026#39;\\u0026#34; --data-binary \\u0026#34;\\u0026amp;text=NewLogin:%0AVPS:\${user}@\${localip}%0ATime: \${logintime}%0ALogin from:%0A\${loginip}%0A\${loginfrom}\\u0026#34; \\u0026gt; /dev/null \\u0026amp;\\u0026amp; rm tg.sh\\u0026#39; \\u0026gt;\\u0026gt; tg.sh bash tg.sh \\u0026amp; ","PlainWords":["国内的云服务器大多数都自带了","ssh","登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至","telegram","的功能","文件名","00-ssh-login-alarm-telegram.sh","(其实也可以自己自定义)，将文件放在","/etc/profile.d","目录下。","#!/bin/bash","#填入","telegram","bot","的","token","token=","#填自己telegram的id","id=","#vps","ip","vpsip=$(curl","-s","ip.sb","-4)","#登录时间","logintime=$(TZ=UTC-8","date","\\u0026#39;+%Y-%m-%d","%H:%M:%S\\u0026#39;)","#远程登录的ip","loginip=$(who","-u","am","i","2\\u0026gt;/dev/null|","awk","\\u0026#39;{print","$NF}\\u0026#39;|sed","-e","\\u0026#39;s/[()]//g\\u0026#39;)","#ip归属asn组织名称","loginfrom=$(curl","-s","https://api.ip.sb/geoip/\${loginip}","|","jq",".asn_organization)","curl","-s","\\u0026#34;https://api.telegram.org/bot\${token}/sendMessage?chat_id=\${id}\\u0026#34;","--data-binary","\\u0026#34;\\u0026amp;text=NewLogin:%0AVPS:","\${vpsip}%0ATime:","\${logintime}%0ALogin","from:%0A\${loginip}%0A\${loginfrom}\\u0026#34;","\\u0026gt;","/dev/null","因为用到了","jq","作为解析","json","的工具，所以需要在包管理器中自行安装。","使用效果：","NewLogin:","VPS:","***.***.***.***","Time:","2020-09-13","12:41:24","Login","from:","***.***.***.***","\\u0026#34;asn_organization\\u0026#34;","脚本使用的","api","来自","ip.sb","2021-10-20","更新","脚本中间更新了几个版本，现在的脚本已经可以实现之前所缺少的一些功能","显示登录用户名","不阻塞登录用户的","TTY","#!/bin/bash","#填入","telegram","bot","的","token","token=","#填自己telegram的id","id=","localip=$(who","-u","am","i","2\\u0026gt;/dev/null|","awk","\\u0026#39;{print","$NF}\\u0026#39;|sed","-e","\\u0026#39;s/[()]//g\\u0026#39;)","echo","\\u0026#39;localip=$(curl","-s","ip.sb","-4)\\u0026#39;","\\u0026gt;","tg.sh","echo","\\u0026#39;user=$(whoami)\\u0026#39;","\\u0026gt;\\u0026gt;","tg.sh","echo","\\u0026#39;logintime=$(TZ=UTC-8","date","\\u0026#34;+%Y-%m-%d","%H:%M:%S\\u0026#34;)\\u0026#39;","\\u0026gt;\\u0026gt;","tg.sh","echo","\\u0026#39;loginip=\\u0026#39;\${localip}","\\u0026gt;\\u0026gt;","tg.sh","echo","\\u0026#39;loginfrom=$(curl","-s","https://api.ip.sb/geoip/\${loginip}","|","jq","-r",".asn_organization)\\u0026#39;","\\u0026gt;\\u0026gt;","tg.sh","echo","\\u0026#39;curl","-s","\\u0026#34;https://api.telegram.org/bot\\u0026#39;\${token}\\u0026#39;/sendMessage?chat_id=\\u0026#39;\${id}\\u0026#39;\\u0026#34;","--data-binary","\\u0026#34;\\u0026amp;text=NewLogin:%0AVPS:\${user}@\${localip}%0ATime:","\${logintime}%0ALogin","from:%0A\${loginip}%0A\${loginfrom}\\u0026#34;","\\u0026gt;","/dev/null","\\u0026amp;\\u0026amp;","rm","tg.sh\\u0026#39;","\\u0026gt;\\u0026gt;","tg.sh","bash","tg.sh","\\u0026amp;"],"Summary":"国内的云服务器大多数都自带了 ssh 登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至 telegram 的功能\\n文件名 00-ssh-login-alarm-telegram.sh (其实也可以自己自定义)，将文件放在 /etc/profile.d 目录下。\\n#!/bin/bash #填入 telegram bot 的 token token= #填自己telegram的id id= #vps ip vpsip=$(curl -s ip.sb -4) #登录时间 logintime=$(TZ=UTC-8 date \\u0026#39;+%Y-%m-%d %H:%M:%S\\u0026#39;) #远程登录的ip loginip=$(who -u am i 2\\u0026gt;/dev/null| awk \\u0026#39;{print $NF}\\u0026#39;|sed -e \\u0026#39;s/[()]//g\\u0026#39;) #ip归属asn组织名称 loginfrom=$(curl -s https://api.ip.sb/geoip/\${loginip} | jq .asn_organization) curl -s \\u0026#34;https://api.telegram.org/bot\${token}/sendMessage?chat_id=\${id}\\u0026#34; --data-binary \\u0026#34;\\u0026amp;text=NewLogin:%0AVPS: \${vpsip}%0ATime: \${logintime}%0ALogin from:%0A\${loginip}%0A\${loginfrom}\\u0026#34; \\u0026gt; /dev/null 因为用到了 jq 作为解析 json 的工具，所以需要在包管理器中自行安装。\\n使用效果：\\nNewLogin: VPS: ***.***.***.*** Time: 2020-09-13 12:41:24 Login from: ***.","Truncated":true,"FuzzyWordCount":200,"WordCount":153,"ReadingTime":1,"Len":7273,"TableOfContents":"\\u003cnav id=\\"TableOfContents\\"\\u003e\\n  \\u003cul\\u003e\\n    \\u003cli\\u003e\\n      \\u003cul\\u003e\\n        \\u003cli\\u003e\\u003ca href=\\"#2021-10-20-更新\\"\\u003e2021-10-20 更新\\u003c/a\\u003e\\u003c/li\\u003e\\n      \\u003c/ul\\u003e\\n    \\u003c/li\\u003e\\n  \\u003c/ul\\u003e\\n\\u003c/nav\\u003e","RawContent":"\\n国内的云服务器大多数都自带了 ssh 登录提示功能，这个功能我觉得不错，但是在很多并没有深度定制系统镜像的云服务器服务商那里就没有远程登录提醒功能了，于是写了一个小脚本来实现远程登录就将登录信息推送至 telegram 的功能\\n\\n文件名 \`00-ssh-login-alarm-telegram.sh\` (其实也可以自己自定义)，将文件放在 \`/etc/profile.d\` 目录下。\\n\\n\`\`\`bash\\n#!/bin/bash\\n\\n#填入 telegram bot 的 token\\ntoken=\\n#填自己telegram的id\\nid=\\n\\n#vps ip\\nvpsip=$(curl -s ip.sb -4)\\n#登录时间\\nlogintime=$(TZ=UTC-8 date '+%Y-%m-%d %H:%M:%S')\\n#远程登录的ip\\nloginip=$(who -u am i 2\\u003e/dev/null| awk '{print $NF}'|sed -e 's/[()]//g')\\n#ip归属asn组织名称\\nloginfrom=$(curl -s https://api.ip.sb/geoip/\${loginip} | jq .asn_organization)\\ncurl -s \\"https://api.telegram.org/bot\${token}/sendMessage?chat_id=\${id}\\" --data-binary \\"\\u0026text=NewLogin:%0AVPS: \${vpsip}%0ATime: \${logintime}%0ALogin from:%0A\${loginip}%0A\${loginfrom}\\" \\u003e /dev/null\\n\`\`\`\\n\\n因为用到了 \`jq\` 作为解析 json 的工具，所以需要在包管理器中自行安装。\\n\\n使用效果：\\n\`\`\`\\nNewLogin:\\nVPS: ***.***.***.***\\nTime: 2020-09-13 12:41:24\\nLogin from:\\n***.***.***.***\\n\\"asn_organization\\"\\n\`\`\`\\n\\n*脚本使用的 api 来自 ip.sb*\\n\\n### 2021-10-20 更新\\n\\n脚本中间更新了几个版本，现在的脚本已经可以实现之前所缺少的一些功能\\n\\n- 显示登录用户名\\n- 不阻塞登录用户的 TTY\\n\\n\`\`\`shell\\n#!/bin/bash\\n\\n#填入 telegram bot 的 token\\ntoken=\\n#填自己telegram的id\\nid=\\n\\nlocalip=$(who -u am i 2\\u003e/dev/null| awk '{print $NF}'|sed -e 's/[()]//g')\\n\\necho 'localip=$(curl -s ip.sb -4)' \\u003e tg.sh\\necho 'user=$(whoami)' \\u003e\\u003e tg.sh\\necho 'logintime=$(TZ=UTC-8 date \\"+%Y-%m-%d %H:%M:%S\\")' \\u003e\\u003e tg.sh\\necho 'loginip='\${localip} \\u003e\\u003e tg.sh\\necho 'loginfrom=$(curl -s https://api.ip.sb/geoip/\${loginip} | jq -r .asn_organization)' \\u003e\\u003e tg.sh\\necho 'curl -s \\"https://api.telegram.org/bot'\${token}'/sendMessage?chat_id='\${id}'\\" --data-binary \\"\\u0026text=NewLogin:%0AVPS:\${user}@\${localip}%0ATime: \${logintime}%0ALogin from:%0A\${loginip}%0A\${loginfrom}\\" \\u003e /dev/null \\u0026\\u0026 rm tg.sh' \\u003e\\u003e tg.sh\\n\\nbash tg.sh \\u0026\\n\`\`\`","ResourceType":"page","MediaType":{"mainType":"application","subType":"octet-stream","delimiter":".","firstSuffix":{"suffix":"","fullSuffix":""},"type":"application/octet-stream","string":"application/octet-stream","suffixes":[""]},"Permalink":"https://blog.lvcshu.com/2020/09/13/vps-%E7%99%BB%E5%BD%95%E6%8E%A8%E9%80%81/","RelPermalink":"/2020/09/13/vps-%E7%99%BB%E5%BD%95%E6%8E%A8%E9%80%81/","Name":"vps 登录推送","Title":"vps 登录推送","Params":{"date":"2020-09-13T13:10:21Z","draft":false,"iscjklanguage":false,"lastmod":"2020-09-13T13:10:21Z","publishdate":"2020-09-13T13:10:21Z","slug":"vps-登录推送","tags":["vps","安全"],"title":"vps 登录推送"},"Data":{},"Date":"2020-09-13T13:10:21Z","Lastmod":"2020-09-13T13:10:21Z","PublishDate":"2020-09-13T13:10:21Z","ExpiryDate":"0001-01-01T00:00:00Z","Aliases":null,"BundleType":"","Description":"","Draft":false,"IsHome":false,"Keywords":null,"Kind":"page","Layout":"","LinkTitle":"vps 登录推送","IsNode":false,"IsPage":true,"Path":"posts/vps-登录推送.md","Pathc":"posts/vps-登录推送.md","Slug":"vps-登录推送","Lang":"en","IsSection":false,"Section":"posts","SectionsEntries":["posts"],"SectionsPath":"posts","Sitemap":{"ChangeFreq":"","Priority":-1,"Filename":"sitemap.xml"},"Type":"posts","Weight":0,"Language":{"Lang":"en","LanguageName":"","LanguageDirection":"","Title":"","Weight":0,"Disabled":false,"ContentDir":"","Cfg":{},"LocalCfg":{},"Provider":{}},"File":{"File":{}},"GitInfo":{"hash":"","abbreviatedHash":"","subject":"","authorName":"","authorEmail":"","authorDate":"0001-01-01T00:00:00Z","commitDate":"0001-01-01T00:00:00Z"},"CodeOwners":null,"OutputFormats":[{"Rel":"canonical","Format":{"mediaType":"text/html","name":"HTML","path":"","baseName":"index","rel":"canonical","protocol":"","isPlainText":false,"isHTML":true,"noUgly":false,"notAlternative":false,"permalinkable":true,"weight":10}}],"AlternativeOutputFormats":null,"Menus":null,"TranslationKey":"page/posts/vps-登录推送","IsTranslated":false,"AllTranslations":null,"Translations":null,"Store":{},"GetIdentity":{"Type":"content","Path":"posts/vps-登录推送.md"}}`</script><div><ul class=post-copyright><li class=post-copyright-author><a>本文作者: </a>johnpoint</li><li class=post-copyright-link><a>本文链接:</a>
<a href id=copyrightlink>https://blog.lvcshu.com/2020/09/13/vps-%E7%99%BB%E5%BD%95%E6%8E%A8%E9%80%81/</a></li><li class=post-copyright-license><a>版权声明:</a>
本作品采用<a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>知识共享署名-相同方式共享 4.0 国际许可协议</a>进行许可。</li><svg xmlns="http://www.w3.org/2000/svg" class="copyright-img" viewBox="0 0 496 512"><path fill="#4a4a4a" d="m245.8 214.9-33.2 17.3c-9.4-19.6-25.2-20-27.4-20-22.2.0-33.3 14.6-33.3 43.9.0 23.5 9.2 43.8 33.3 43.8 14.4.0 24.6-7 30.5-21.3l30.6 15.5a73.2 73.2.0 01-65.1 39c-22.6.0-74-10.3-74-77 0-58.7 43-77 72.6-77 30.8-.1 52.7 11.9 66 35.8zm143 0-32.7 17.3c-9.5-19.8-25.7-20-27.9-20-22.1.0-33.2 14.6-33.2 43.9.0 23.5 9.2 43.8 33.2 43.8 14.5.0 24.7-7 30.5-21.3l31 15.5c-2 3.8-21.3 39-65 39-22.7.0-74-9.9-74-77 0-58.7 43-77 72.6-77C354 179 376 191 389 214.8zM247.7 8C104.7 8 0 123 0 256c0 138.4 113.6 248 247.6 248C377.5 504 496 403 496 256 496 118 389.4 8 247.6 8zm.8 450.8c-112.5.0-203.7-93-203.7-202.8.0-105.5 85.5-203.3 203.8-203.3A201.7 201.7.0 01451.3 256c0 121.7-99.7 202.9-202.9 202.9z"/></svg></ul></div><nav class=paginav><a class=prev href=https://blog.lvcshu.com/2020/10/09/upgrade-to-python-3.9/><span class=title>« Prev</span><br><span>编译安装 python 3.9</span></a>
<a class=next href=https://blog.lvcshu.com/2020/06/13/liunx-jetbrains-%E8%BD%AF%E4%BB%B6%E8%BE%93%E5%85%A5%E4%B8%AD%E6%96%87/><span class=title>Next »</span><br><span>liunx jetbrains 软件输入中文</span></a></nav></footer></article><style>.copyright-img{position:absolute;width:128px;height:128px;top:-35px;right:5%;opacity:.1;filter:invert(100%)}.post-copyright{border-radius:var(--radius);margin:2em 0 0;padding:.5em 1em;border-left:3px solid #ff1700;background-color:var(--code-bg);list-style:none;position:relative;overflow:hidden}.post-copyright li{margin:8px 0}</style></main><footer class=footer><span>&copy; 2023 <a href=https://blog.lvcshu.com/>johnpoint's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>